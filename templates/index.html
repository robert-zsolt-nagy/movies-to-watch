<!doctype html>
<html>
<head>
  <title>Movies-to-watch</title>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script src="{{ url_for('static', filename='htmx.min.js') }}"></script>
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>Movies-to-watch Home</h1>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div>
        {% for message in messages %}  
            <p>{{ message }}</p><br>
        {% endfor %}
        </div>
    {% endif %}
  {% endwith %}
  {% if logged_on %}
  <div>
    <p> Current user: {{ logged_on }}</p>
    <!-- <p> Verified: {{verified}}</p>
    <p> TMDB Linked: {{tmdb_linked}}</p> -->
  </div>
    {% if verified %}
      {% if tmdb_linked == None%}
        <div>
          <p>Please link your TMDB Account to access all features of Movies-to-watch!</p>
          <p>You can link your account from <a href="/profile">your Profile</a> page.</p>
        </div>
      {% else %}
        <div>
          <p> Current infos</p><br>
          {% for key, value in display.items() %}
          <div id="movie-{{value['id']}}">
            <h2>{{value['title']}}</h2>
            <p><image src={{value['poster']}} width="300" height="450"></image></p>
            <p>{{value['overview']}}</p>
            <p>Genres: {{value['genres']}}</p>
            <p>Runtime: {{value['runtime']}} Minutes</p>
            <p>Release date: {{value['release_date']}}</p>
            <p><a href={{value['trailer']}} target="_blank">Watch the trailer</a></p>
            <div>
              <p>Stream: </p>
              {% for elem in value['providers']['stream'] %}
              <image src={{elem['logo_path']}} title="{{elem['provider_name']}}"></image>
              {% endfor %}
            </div>
            <div>
              <p>Rent: </p>
              {% for elem in value['providers']['rent'] %}
              <image src={{elem['logo_path']}} title="{{elem['provider_name']}}"></image>
              {% endfor %}
            </div>
            <div>
              <p>Buy: </p>
              {% for elem in value['providers']['buy'] %}
              <image src={{elem['logo_path']}} title="{{elem['provider_name']}}"></image>
              {% endfor %}
            </div>
            <p>You voted: {{value['vote']}}</p>
          </div>
          {% endfor %}
          <a href="/profile">My Profile</a><br>
        </div> 
      {% endif %}
    {% else%}
    <div>
      <p>Your email is not verified.</p>
      <p>Please verify your email to access all features of Movies-to-watch!</p>
      <p><a href="/resend-verification">Resend verfication email.</a></p>
    </div>
    {% endif%} 
  <a href="/logout">Log out</a><br>
  {% else %}
  <div>
    <p> You are not logged in. </p><br><br>
    <a href="/login">Log in</a>
  </div> 
  {% endif %}
  <p>Made by Narogi</p>
</body>
</html>